<!DOCTYPE html>

<head>
    <style>

        #map {
            margin-top: 10px;
            margin-left: 10px;
            height: 80%;
            width: 80%;
            margin-left: auto;
            border-radius: 10px;
            margin-right: auto;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

    </style>

    <title>manager page</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
    <button>refresh routs</button>
    <div id="map"></div>
</body>

<script>
    var map;
    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            zoom:10,
            center: new google.maps.LatLng(12.8,18.31),
            mapTypeId: 'terrain'
        });
    }
    $(document).ready(function(){
        $("button").click(function(){
            //getting a object  of all drones
            $.ajax({
                url: 'http://18.207.210.26/api.php?action=getAllDrones',
                dataType: 'json',
                type: 'get',
                success: function( data, textStatus, jQxhr ){
                    $('#response pre').html( data );

                    var flightCoordinates = [];
                    for( var i=0 ; i<data.records[1].data.length ; i++) {
                        //getting lat long from object
                        var latLng = new google.maps.LatLng(parseFloat(data.records[1].data[i].long), parseFloat(data.records[1].data[i].lat));
                        //creating new marker
                        var marker = new google.maps.Marker({
                            position: latLng,
                            map: map,
                            title: data.records[1].data[i].time
                        });

                        //adding listener to the marker in order to add url to s3
                        marker.addListener('click' , function () {
                            //data.records[1].data[i].image
                            window.open("https://s3-eu-west-1.amazonaws.com/drones-bucket/IMG_0001.jpg");

                        });

                        //adding new lat long point to route
                        flightCoordinates.push({ lat: parseFloat(data.records[1].data[i].long), lng:parseFloat(data.records[1].data[i].lat) });

                        //prepare to draw the route by the flightCoordinate array
                        var flightPath = new google.maps.Polyline({
                            path: flightCoordinates,
                            geodesic: true,
                            strokeColor: data.records[1].color,
                            strokeOpacity:0.5,
                            strokeWeight: 1
                        });
                        //drawing the route
                        flightPath.setMap(map);
                    }
                },
                error: function( jqXhr, textStatus, errorThrown ){
                    console.log( errorThrown );
                }
            });
        });
    });
</script>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBa52aeMfGDZVZ-iJQjido6yfcRyV6t4tM&callback=initMap">
</script>

</html>